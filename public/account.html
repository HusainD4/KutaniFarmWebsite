<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account - Kutani Farm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- Font Awesome -->
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/assets/css/StylesPublic.css">
</head>

<body>

<!-- Header Section -->
<header class="d-flex justify-content-center align-items-center p-3">
    <!-- Logo, hidden on small screens -->
    <div class="logo d-none d-lg-block">
        <a href="/public/HomePage.html">
            <img src="/assets/images/LogoKutaniFarm.png" alt="Kutani Farm Logo" style="height: 35px;">
        </a>
    </div>
</header>


<!-- Navbar Section -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <!-- Logo Section for Mobile Devices (Visible on small screens) -->
        <a class="navbar-brand d-block d-lg-none" href="HomePage.html">
            <img src="/assets/images/LogoKutaniFarm.png" alt="Kutani Farm Logo" style="height: 30px;">
        </a>

        <!-- Navbar Toggler for small screens -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar Links (Centered) -->
        <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a href="HomePage.html" class="nav-link">Beranda</a>
                </li>
                <li class="nav-item">
                    <a href="Produk.html" class="nav-link">Produk</a>
                </li>
                <li class="nav-item">
                    <a href="TentangKami.html" class="nav-link">Tentang Kami</a>
                </li>
                <li class="nav-item">
                    <a href="kontak.html" class="nav-link">Kontak</a>
                </li>
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Akun
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="profileDropdown">
                        <li><a href="account.html" class="dropdown-item">Detail Akun</a></li>
                        <li><a href="cart.html" class="dropdown-item">Pesanan Saya</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>



    <!-- Account Section -->
    <div class="container" style="max-width: 900px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
        <h2 style="text-align: center; margin-bottom: 30px;">My Account</h2>
        <hr>

        <!-- Ucapan Selamat Datang -->
        <div id="welcome-message" style="text-align: center; font-size: 18px; margin-bottom: 20px;">
            <!-- Ucapan selamat datang akan muncul di sini -->
        </div>
    </div>

    <!-- Account Details -->
    <div class="container" style="max-width: 900px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
        <h3>Detail Informasi Pribadi</h3>
        <form id="account-form" >
            <div class="form-group" style="margin-top: 10px;">
                <label for="username" style="margin-bottom: 10px; ">Username</label >
                <input type="text" class="form-control" id="username" disabled>
            </div>

            <div class="form-group" style="margin-top: 10px;">
                <label for="email" style="margin-bottom: 10px;">Email Address</label>
                <input type="email" class="form-control" id="email">
            </div>

            <div class="form-group" style="margin-top: 10px;">
                <label for="phone" style="margin-bottom: 10px;">Phone Number</label>
                <input type="text" class="form-control" id="phone">
            </div>

            <div class="form-group" style="margin-top: 10px;">
                <label for="address" style="margin-bottom: 10px;">Shipping Address</label >
                <textarea class="form-control" id="address" rows="4"></textarea>
            </div>

            <div class="form-group" style="padding-top: 30px; display: flex; justify-content: flex-end;">
                <button type="submit" class="btn" style="background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                    Save Changes
                </button>
            </div>
        </form>
    </div>

    <!-- Change Password Section -->
    <div class="container" style="max-width: 900px; margin: 40px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); padding-top: 20px; ">

    <!-- Account Details -->
    <h3>Ubah Password</h3>
    <hr>
    <form id="password-form">
        <div class="form-group" style="margin-top: 10px;">
            <label for="current-password">Kata Sandi Saat Ini</label>
            <div class="input-group" style="margin-top: 10px;">
                <input type="password" class="form-control" id="current-password" required>
                <span class="input-group-text" id="eye-icon-current" style="cursor: pointer;">
                    <!-- Custom SVG Icon for Eye -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" id="eye-icon-current-svg" style="width: 20px; height: 20px;">
                        <path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/>
                    </svg>
                </span>
            </div>

        <div class="form-group" style="margin-top: 10px;">
            <label for="new-password">Kata Sandi Baru</label >
            <div class="input-group" style="margin-top: 10px;">
                <input type="password" class="form-control" id="new-password" required >
                <span class="input-group-text" id="eye-icon-new" style="cursor: pointer;">
                    <!-- Custom SVG Icon for Eye -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" id="eye-icon-new-svg" style="width: 20px; height: 20px;">
                        <path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/>
                    </svg>
                </span>
            </div>
        </div>

        <div class="form-group" style="margin-top: 10px;">
            <label for="confirm-password">Konfirmasi Kata Sandi Baru</label>
            <div class="input-group" style="margin-top: 10px;">
                <input type="password" class="form-control" id="confirm-password" required >
                <span class="input-group-text" id="eye-icon-confirm" style="cursor: pointer;">
                    <!-- Custom SVG Icon for Eye -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" id="eye-icon-confirm-svg" style="width: 20px; height: 20px;">
                        <path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/>
                    </svg>
                </span>
            </div>
        </div>

        <div class="form-group" style="padding-top: 30px; display: flex; justify-content: flex-end;">
            <button type="submit" class="btn" style="background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                Update Password
            </button>
        </div>
    </form>
</div>

    <!-- Logout Button -->
    <div class="container" style="display: flex; justify-content: flex-center;">
        <button id="logout-btn" class="btn logout-btn" style="background-color: #dc3545; color: white; margin-top: 20px; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
            Logout
        </button>
    </div>
</div>
    <!-- Footer Section -->
    <footer style="background-color: #ffffff; color: #3e6d2b; text-align: center; padding: 10px 0; position: relative; width: 100%; bottom: 0; box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.1);">
        <p>&copy; 2025 Kutani Farm. All rights reserved. | <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
    </footer>
    
    <!-- Firebase SDK & Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, updatePassword, reauthenticateWithCredential, EmailAuthProvider } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBrc8_nPdvVoJg99Fsi80NZLnt8LiBN3EI",
            authDomain: "kutanifarm.firebaseapp.com",
            projectId: "kutanifarm",
            storageBucket: "kutanifarm.appspot.com",
            messagingSenderId: "1063275158126",
            appId: "1:1063275158126:web:8af2bc74da9db5c8e3a47f",
            measurementId: "G-Z3TGPQJW2V"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;

        // Function to fetch account data
        async function fetchAccountData() {
            const userDocRef = doc(db, "users", currentUser.uid);
            const userDoc = await getDoc(userDocRef);
            if (userDoc.exists()) {
                const data = userDoc.data();
                document.getElementById("username").value = currentUser.displayName || "No username";
                document.getElementById("email").value = data.email || "";
                document.getElementById("phone").value = data.phone || "";
                document.getElementById("address").value = data.address || "";
            } else {
                alert("No account found in database.");
                window.location.href = "/Administrator/login.html"; // Redirect to login page if no data found
            }
        }

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;

                // Display welcome message
                const welcomeMessage = document.getElementById("welcome-message");
                welcomeMessage.innerText = `Welcome, ${currentUser.displayName || 'User'}!`;

                // Fetch account data
                fetchAccountData();
            } else {
                window.location.href = "/Administrator/login.html"; // Redirect to login page if not logged in
            }
        });

        // Eye Icon Toggle Password Visibility
        function togglePasswordVisibility(inputId, eyeIconId) {
            const inputField = document.getElementById(inputId);
            const eyeIcon = document.getElementById(eyeIconId);
            const svgIcon = eyeIcon.querySelector('svg');

            if (inputField.type === "password") {
                inputField.type = "text";
                svgIcon.style.transform = "rotate(180deg)"; // Rotate the icon when password is visible
            } else {
                inputField.type = "password";
                svgIcon.style.transform = "rotate(0deg)"; // Reset rotation when password is hidden
            }
        }


        // Event listeners for password visibility toggle
        document.getElementById("eye-icon-current").addEventListener("click", () => {
            togglePasswordVisibility("current-password", "eye-icon-current");
        });
        document.getElementById("eye-icon-new").addEventListener("click", () => {
            togglePasswordVisibility("new-password", "eye-icon-new");
        });
        document.getElementById("eye-icon-confirm").addEventListener("click", () => {
            togglePasswordVisibility("confirm-password", "eye-icon-confirm");
        });

        // Save Account Data
        document.getElementById("account-form").addEventListener("submit", async (event) => {
            event.preventDefault();
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;
            const address = document.getElementById("address").value;

            try {
                const userDocRef = doc(db, "users", currentUser.uid);
                await setDoc(userDocRef, {
                    email,
                    phone,
                    address
                }, { merge: true });

                alert("Account information updated successfully!");
            } catch (error) {
                console.error("Error updating account data:", error);
            }
        });

        // Update Password
        document.getElementById("password-form").addEventListener("submit", async (event) => {
            event.preventDefault();
            const currentPassword = document.getElementById("current-password").value;
            const newPassword = document.getElementById("new-password").value;
            const confirmPassword = document.getElementById("confirm-password").value;

            if (newPassword !== confirmPassword) {
                alert("Passwords do not match!");
                return;
            }

            const credential = EmailAuthProvider.credential(currentUser.email, currentPassword);

            try {
                await reauthenticateWithCredential(currentUser, credential);
                await updatePassword(currentUser, newPassword);
                alert("Password updated successfully!");
            } catch (error) {
                console.error("Error updating password:", error);
                alert("Error updating password. Please try again.");
            }
        });

        // Logout Function
        document.getElementById("logout-btn").addEventListener("click", async () => {
            try {
                await signOut(auth);
                window.location.href = "/Administrator/login.html"; // Redirect to login page after logout
            } catch (error) {
                console.error("Error logging out:", error);
                alert("Error logging out. Please try again.");
            }
        });
    </script>

    

</body>

</html>
